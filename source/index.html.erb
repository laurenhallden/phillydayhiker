---
layout: homepage
---
<%
%>

<span class="nprogress-logo fade"></span>
<nav class="navbar navbar-main hidden-sm hidden-xs" data-search-index="false">
    <div class="navbar-header">
      <a href="/" class="navbar-brand"><img class="brand-logo" src="/images/brand-icon.svg"/><div class="brand-title">Philly Day Hiker</div></a>
    </div>
    <ul class="nav navbar-nav navbar-right">
      <li><div class="nav-item nav-item-rotate nav-item-slide" id="destinations">Destinations <i class="fa fa-caret-down"></i></div>
      </li>
      <li><div class="nav-item nav-item-rotate nav-item-slide" id="about">About <i class="fa fa-caret-down"></i></div>
      </li>
      <li><div class="nav-item" data-toggle="modal" data-target="#tipsModal">Contact <i class="fa fa-caret-down"></i></div>
      </li>
      <li><a href="/kayak" class="nav-item nav-item-rotate nav-item-slide" id="kayak-map"><span class="tag">New!</span>Kayak map<i class="icon"></i></a>
      </li>
    </ul>
</nav>

<nav class="navbar navbar-mobile visible-sm visible-xs" data-search-index="false">
  <div class="container" id="mobile-nav-container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/" class="navbar-brand"><img class="brand-logo" src="/images/brand-icon.svg"/><div class="brand-title">Philly Day Hiker</div></a>
    </div>
    <div class="collapse navbar-collapse" id="navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
          <a class="dropdown-toggle nav-item" data-toggle="dropdown" href="javascript:void(0)">Destinations <i class="fa fa-caret-down"></i></a>

          <ul class="dropdown-menu navigation-list">
             <li class="filters-list">
              <!-- Filters -->
              <%= partial '/partials/filters' %>
            </li>

            <% data.phillydayhiker.destinations
            .sort_by { |id, destination| destination.name }
            .each do |id, destination| %>

              <li>
              <a title="<%= destination.name %>" href="/destinations/<%= destination.slug %>">
                  <%= destination.name %>
              </a>
            </li>
            <% end %>
          </ul>
        </li>
        <li class="dropdown">
          <a class="dropdown-toggle nav-item" data-toggle="dropdown" href="javascript:void(0)">About <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu about-menu">
            <div class="container about-pdh-content">
              <%= partial '/partials/about' %>
            </div>
          </ul>
        </li>
        <!--
        <li class="dropdown">
          <a class="dropdown-toggle nav-item" data-toggle="dropdown" href="javascript:void(0)">Search <i class="fa fa-caret-down"></i></a>
          <ul class="dropdown-menu mobile-search">
            {# Simple search form, remove from search index #}
            <form action="/search-results/" method="get" data-search-index="false">
            <input type="text" name="q" placeholder="&nbsp;What are you looking for?" id="tipue_search_input" />
            </form>
          </ul>
        </li>-->
        <li>
          <a class="nav-item" href="javascript:void(0)" data-toggle="modal" data-target="#tipsModal">Submit a tip <i class="fa fa-caret-down"></i></a>
        </li>
        <li><a href="/kayak" class="nav-item nav-item-rotate nav-item-slide" id="kayak-map"><span class="tag">New!</span>Kayak map<i class="icon"></i></a>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="view-destinations hidden-sm hidden-xs" data-search-index="false">
  <div class="container">

    <!-- Filters -->
    <%= partial '/partials/filters' %>

      <ul class="navigation-list">

        <script type="text/javascript">
        // set a js variable that has all our destinations as an array, so we can filter them dynamically
          var myDestinations = [];
          <% data.phillydayhiker.destinations.each do |id, destination| %>
            myDestinations.push( {"slug":"<%= destination.slug %>",
              "has_easy_trails":"<%= destination.has_easy_trails %>",
              "has_difficult_trails":"<%= destination.has_difficult_trails %>",
              "more_amenities":"<%= destination.more_amenities %>",
              "more_natural":"<%= destination.more_natural %>",
              "dogs":"<%= destination.dogs %>",
              "boats":"<%= destination.boats %>",
            } );
          <% end %>
        </script>

        <% data.phillydayhiker.destinations
        .sort_by { |id, destination| destination.name }
        .each do |id, destination| %>

          <li>
            <a title="<%= destination.name %>" href="/destinations/<%= destination.slug %>">
                <%= destination.name %>
            </a>
          </li>

        <% end %>

      </ul>

  </div>
</div>

<div class="about-pdh hidden-sm hidden-xs" data-search-index="false">
  <div class="container about-pdh-content">
    <%= partial '/partials/about' %>
  </div>
</div>

<div class="modal fade" id="tipsModal" tabindex="-1" role="dialog" aria-labelledby="tipsModal" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h4>Add to Philly Day Hiker</h4>
      </div>
      <div class="modal-body">
        <div class="cognito">
          <script src="https://services.cognitoforms.com/s/PCAi_ZJ9-E-MpvgklVWAVg"></script>
          <script>Cognito.load("forms", { id: "1" });</script>
        </div>
        <a class="modal-back link-subtle" href="javascript:void(0)" data-dismiss="modal">Go back</a>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="donateModal" tabindex="-1" role="dialog" aria-labelledby="donateModal" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        <h4>Thanks for your support!</h4>
      </div>
      <div class="modal-body">
        <p>Wanna help cover our hosting costs and map licenses? You're the best! We accept small tips via PayPal.</p>
          <form id="donate-form" action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
          <input type="hidden" name="cmd" value="_s-xclick">
          <input type="hidden" name="hosted_button_id" value="N3MW3U5GYQ4JY">
          <input type="image" id="paypal-button" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
          <img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
        </form>
        <a class="modal-back link-subtle" href="javascript:void(0)" data-dismiss="modal">Go back</a>
      </div>
    </div>
  </div>
</div>

<div id='map' class="full-height"></div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>

  <!-- mapbox gl js map -->
  <script>
    mapboxgl.accessToken = 'pk.eyJ1IjoibGF1cmVuaGFsbGRlbiIsImEiOiJjaWtvMXQzMnIwdXFwdHpqN21hMG84MGMxIn0.bMeEalyqwCOvDs_a8AeETw';
    var map = new mapboxgl.Map({
        container: 'map', // container id
        style: 'mapbox://styles/laurenhallden/civxwk4jt006g2klkep3qszns', //stylesheet location
        center: [-75.163, 39.976], // starting position
        zoom: 9 // starting zoom
    });

// Geolocation: set some options
  var options = {
    enableHighAccuracy: true,
    timeout: 10000, // wait 10 seconds before giving up
    maximumAge: 0
  };

  // Geolocation: add layer and styles for a single point
  map.on('load', function () {
    map.addSource('single-point', {
      "type": "geojson",
      "data": {
        "type": "FeatureCollection",
        "features": []
      }
    });

    map.addLayer({
      "id": "point",
      "source": "single-point",
      "type": "circle",
      "paint": {
        "circle-radius": 6,
        "circle-color": "#0388bb"
      }
    });

    // Geolocation: set success and error states for geolocation attempt
    function errorCallback() {
      alert("We were unable to find you. Does your browser accept location services?");
    }
     
    function successCallback(pos) {
      stopProgress();
      var userLocation = {
          type: 'Point',
          coordinates: [pos.coords.longitude, pos.coords.latitude]
        };
      // set point at user location
      map.getSource('single-point').setData(userLocation);
      // fly map to user location
      map.flyTo({center:[pos.coords.longitude, pos.coords.latitude], zoom:[14]});
    }

    // Geolocation: run it
    $('#geolocate').click(function() {
       if (navigator && navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(successCallback, errorCallback);
          locatingProgress();
        } else {
          alert('Geolocation is not supported');
        }
    });

    // Popups: change popup cursors to pointer
    map.on('mousemove', function (f) {
      var pointers = map.queryRenderedFeatures(f.point, { layers: ['zoomed-features','places'] });
      map.getCanvas().style.cursor = (pointers.length) ? 'pointer' : '';
    });
  });

  // When a click event occurs near a BLUE location marker, open a popup at the location of
  // the feature, with description HTML from its properties.
  map.on('click', function (e) {
    var features = map.queryRenderedFeatures(e.point, { layers: ['places'] });

    if (!features.length) {
      return;
    } else {
      // Get coordinates from the symbol and center the map on those coordinates
      map.flyTo({center: features[0].geometry.coordinates});
    }

    var feature = features[0];

    // Populate the popup and set its coordinates
    // based on the feature found.
    var popup = new mapboxgl.Popup()
      .setLngLat(feature.geometry.coordinates)
      .setHTML("<a href='" + feature.properties.link +"'>" + feature.properties.title + "</a>")
      .addTo(map);
  });

  // When a click event occurs near a YELLOW feature marker, open a popup at the location of
  // the feature, with description HTML from its properties.
  map.on('click', function (f) {
    var highlights = map.queryRenderedFeatures(f.point, { layers: ['zoomed-features'] });

    if (!highlights.length) {
      return;
    } else {
      // Get coordinates from the symbol and center the map on those coordinates
      var oldcoords = highlights[0].geometry.coordinates;
      var oldlat = oldcoords[0];
      var oldlong = oldcoords[1];
      var newlong = (oldlong + 0.00450);
      map.flyTo({center:[oldlat, newlong]});
    }

    var highlight = highlights[0];

    // Populate the popup and set its coordinates
    // based on the feature found.
    var popup = new mapboxgl.Popup()
      .setLngLat(highlight.geometry.coordinates)
      .setHTML(highlight.properties.title + '<br/>' + highlight.properties.description)
      .addTo(map);
  });

  // Add zoom and rotation controls to the map.
  var nav = new mapboxgl.NavigationControl();
  map.addControl(nav, 'top-left');

  var mapCanvas = $('.mapboxgl-canvas')[0];
  var mapDiv = document.getElementById('map');

  // Add our custom control buttons for Geolocate, Fullscreen & Satellite
  $( ".mapboxgl-ctrl-top-left" ).append( "<div class='mapboxgl-ctrl mapboxgl-ctrl-group'><button class='mapboxgl-ctrl-icon mapboxgl-ctrl-icon-reset' id='reset' type='button' aria-label='Reset'></button><button class='mapboxgl-ctrl-icon mapboxgl-ctrl-icon-fullscreen' id='full-screen' type='button' aria-label='Fullscreen'></button><button class='mapboxgl-ctrl-icon mapboxgl-ctrl-icon-satellite' id='satellite' type='button' aria-label='Satellite'></button></div><div class='mapboxgl-ctrl mapboxgl-ctrl-group'><button class='mapboxgl-ctrl-icon mapboxgl-ctrl-icon-geolocate' id='geolocate' type='button' aria-label='Geolocate'></button></div>" );

  // Reset button: 
  $('#reset').click(function() {
    map.flyTo({center:[-75.163, 39.976], zoom:[9]});
  });

</script>
<script src="/js/fullscreen.js"></script>
<script src="/js/satellite.js"></script>
<%= partial '/partials/js' %>